<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#f0f2f4] px-10 py-3">
  <!-- Logo y Nombre Zetteri -->
  <div class="flex items-center gap-3 text-[#111418]">
    <div class="h-10 w-10 flex items-center justify-center">
      <img src="zetteri-logo-nobck.png" alt="Zetteri Logo" class="h-8 w-8 object-contain" />
    </div>
    <h2 class="text-[#111418] text-lg font-bold leading-tight tracking-[-0.015em]">Zetteri</h2>
  </div>
  
  <!-- Navegación y Perfil -->
  <div class="flex flex-1 justify-end gap-4">
    <div class="flex items-center gap-9">
      <a class="text-[#111418] text-sm font-medium leading-normal" href="dashboard.html">Dashboard</a>
      <a class="text-[#111418] text-sm font-medium leading-normal" href="appointments.html">Appointments</a>
      <a class="text-[#111418] text-sm font-medium leading-normal" href="crm.html">CRM</a>
    </div>
    
    <!-- Botón de Notificaciones -->
    <button class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 bg-[#f0f2f4] text-[#111418] gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
      <div class="text-[#111418]" data-icon="Bell" data-size="20px" data-weight="regular">
        <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
          <path d="M221.8,175.94C216.25,166.38,208,139.33,208,104a80,80,0,1,0-160,0c0,35.34-8.26,62.38-13.81,71.94A16,16,0,0,0,48,200H88.81a40,40,0,0,0,78.38,0H208a16,16,0,0,0,13.8-24.06ZM128,216a24,24,0,0,1-22.62-16h45.24A24,24,0,0,1,128,216ZM48,184c7.7-13.24,16-43.92,16-80a64,64,0,1,1,128,0c0,36.05,8.28,66.73,16,80Z"></path>
        </svg>
      </div>
    </button>
    
    <!-- Dropdown de Perfil -->
    <div class="relative">
      <button id="profile-dropdown-btn" class="bg-[#f0f2f4] rounded-full p-1 flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-[#197fe5]">
        <div id="user-profile-picture" class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" style='background-image: url("https://assets.zyrosite.com/AoPqRVW0MkiDWnyz/my-notion-face-portrait-AR0MrvjwKosxVEgo.png");'></div>
        <svg class="ml-1" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M6 9l6 6 6-6"/>
        </svg>
      </button>
      
      <!-- EL DROPDOWN MENU QUE FALTA -->
      <div id="profile-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-[#e3eaf6] z-50">
        <ul class="py-1">
          <li>
            <a href="profile.html" class="block px-4 py-2 text-[#111418] hover:bg-[#f0f2f4]">Profile</a>
          </li>
          <li>
            <a href="settings.html" class="block px-4 py-2 text-[#111418] hover:bg-[#f0f2f4]">Settings</a>
          </li>
          <li>
            <button id="logout-btn-dropdown" class="w-full text-left px-4 py-2 text-[#d32f2f] hover:bg-[#f0f2f4]">Logout</button>
          </li>
        </ul>
      </div>
    </div>
  </div>
</header>

</header>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

  // Configuración de Firebase (asegúrate que sea la correcta)
  const firebaseConfig = {
    apiKey: "AIzaSyBppyJBT_uWC2hIJU-qnMZCNlac5uVTRmM", // Reemplaza con tu config real
    authDomain: "zetter-app.firebaseapp.com",
    projectId: "zetter-app",
    storageBucket: "zetter-app.appspot.com",
    messagingSenderId: "386722095231",
    appId: "1:386722095231:web:f5abe66895fea3746bdf4a",
    measurementId: "G-D7E0PDYDN5"
  };

  // Inicializar Firebase
  const app = initializeApp(firebaseConfig, "headerApp"); // Nombre único para la app del header
  const auth = getAuth(app);

  // Elementos del DOM
  const profileDropdownBtn = document.getElementById('profile-dropdown-btn');
  const profileDropdown = document.getElementById('profile-dropdown');
  const userProfilePicDiv = document.getElementById('user-profile-picture');
  const logoutDropdownBtn = document.getElementById('logout-btn-dropdown');
  // const userNameElement = document.getElementById('user-name-display'); // Descomenta si tienes un elemento para el nombre

  // Lógica del Dropdown
  if (profileDropdownBtn && profileDropdown) {
    profileDropdownBtn.addEventListener('click', (e) => {
      e.stopPropagation(); // Evita que el clic se propague al document
      profileDropdown.classList.toggle('hidden');
    });

    // Cerrar dropdown si se hace clic fuera
    document.addEventListener('click', (e) => {
      if (!profileDropdown.classList.contains('hidden')) { // Si el dropdown está visible
        // Si el clic NO fue en el botón Y NO fue dentro del dropdown
        if (!profileDropdownBtn.contains(e.target) && !profileDropdown.contains(e.target)) {
          profileDropdown.classList.add('hidden');
        }
      }
    });
  } else {
    console.error("Header Script: No se encontró el botón del dropdown o el panel del dropdown.");
  }

  // Lógica de Autenticación
  onAuthStateChanged(auth, (user) => {
    if (user) {
      // Usuario está logueado
      console.log("Usuario logueado:", user.email);
      if (userProfilePicDiv) {
        if (user.photoURL) {
          userProfilePicDiv.style.backgroundImage = `url('${user.photoURL}')`;
        } else {
          // Placeholder si no hay fotoURL, o mantén la actual
          userProfilePicDiv.style.backgroundImage = `url('https://assets.zyrosite.com/AoPqRVW0MkiDWnyz/my-notion-face-portrait-AR0MrvjwKosxVEgo.png')`; // O una imagen por defecto
        }
      }
      // if (userNameElement) {
      //   userNameElement.textContent = user.displayName || user.email; // Muestra nombre o email
      // }

      if (logoutDropdownBtn) {
        logoutDropdownBtn.addEventListener('click', async () => {
          try {
            await signOut(auth);
            console.log("Usuario deslogueado");
            window.location.href = 'index.html'; // Redirigir al login
          } catch (error) {
            console.error("Error al desloguear:", error);
          }
        });
      }
    } else {
      // No hay usuario logueado (esto no debería pasar si las páginas están protegidas,
      // pero es bueno tenerlo por si el header se usa en una página pública)
      console.log("Ningún usuario logueado.");
      if (userProfilePicDiv) {
        // Imagen por defecto si no hay usuario
         userProfilePicDiv.style.backgroundImage = `url('https://assets.zyrosite.com/AoPqRVW0MkiDWnyz/my-notion-face-portrait-AR0MrvjwKosxVEgo.png')`;
      }
      // if (userNameElement) {
      //   userNameElement.textContent = "Guest";
      // }
      // Ocultar opciones de perfil/logout si no hay usuario
      if (profileDropdown) {
        // profileDropdown.classList.add('hidden'); // O podrías deshabilitar los botones
      }
    }
  });
</script>